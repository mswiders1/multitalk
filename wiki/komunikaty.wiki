#summary Komunikaty przesyłane przez sieć

= UWAGA!=

*Wszystkie* komunikaty po TCP/IP rozpoczynają się ciągiem znaków:

{{{
BEGIN_MESSAGE:<długość_wiadomości>\n
<wiadomość_JSON>
}}}

gdzie:
  * `<długość_wiadomości>` - długość wiadomości *po* znaku nowej linii
  * `<wiadomośi_JSON>` - wiadomość w postacji JSON zgodnie z opisem poniżej

Powyższe jest niezbędne do rozpoznania początku i końca pojedynczego komunikatu


= Podłączenie (broadcast) =

Protokół: *UDP*, broadcast

Zawartość: _MULTITALK_5387132_



= Podłączenie (p2p) =

Protokół: *TCP/IP*

Odbiorca: węzeł podany przez użytkownika

Zawartość: _MULTITALK_5387132_


= Podłączenie - odpowiedź =

Protokół: *TCP/IP*

Odbiorca: węzeł podłączający się



|| *nazwa pola* || *typ* || *wartość* ||
|| TYPE || CHAR(3) || _HII_ ||
|| UID || CHAR(32) ||H(MAC + IP + username_) SHA-1 base 64 || 
|| USERNAME || VARCHAR(32) ||  wujo008 ||
|| VECTOR || VEC || _tablica_ ||


Zawartość: tablica informacji o wszystkich użytkownikach (*JSON*)

oraz typ wiadomości i informację o przesysłającym

Postać jednego rekordu tablicy:

|| *nazwa pola* || *typ* ||
|| IP_ADDRESS || VARCHAR(15) ||
|| UID || CHAR(32) ||
|| USERNAME || VARCHAR(32) ||

Przykład:

{{{
{
    "TYPE": "HII",
    "UID": "8IsXHf84O63uktYcIto2wk+h4sw=",
    "USERNAME": "kouodziey",
    "VECTOR": 
        [
            {
                "IP_ADDRESS": "192.168.0.5",
                "UID": "3uktYcIto2saFasD=",
                "USERNAME": "wujo"
            }         
        ]
}

}}}

= Logowanie =

Protokół: *TCP/IP*

Odbiorca: wszyscy użytkownicy, z którymi logujący się węzeł ma połączenie

Zawartość: zestaw informacji o użytkowniku (*JSON*)

|| *nazwa pola* || *typ* || *wartość* ||
|| TYPE || CHAR(3) || _LOG_ ||
|| UID || CHAR(32) || _H(MAC + IP + username_) ||
|| USERNAME || VARCHAR(32) ||  ||

= Przeslanie macierzy wiedzy do nowozalogowanego usera =

Protokół: *TCP/IP*

Odbiorca: Uzytkownik ktory sie dopiero zalogowal

Zawartosc: Informacje o wiedzy

|| *nazwa pola* || *typ* || *wartość* ||
|| TYPE || CHAR(3) || _MTX_ ||
|| MAC || MATRIX || macierz ||
|| VEC || VECTOR || wektor kolejnosci ||

macierz:

kolumnami wiedza uzytkownikow
pojedyncza komorka: wiedza o wiedzy o zegarze logicznym uzytkownikow 

wektor kolejności:
|| id usera, ktory ma wiedze na i-tej kolumnie tabeli||

= przesylanie zwyklych wiadomosci=

Protokół *TCP/IP*
Odbiorca: uzytkownik do ktorego jest skierowana wiadomosc

Zawartość: Macierze wiedzy i zwykła treść wiadomości

|| *nazwa pola* || *typ* || *wartość* ||
|| TYPE || CHAR(3) || _MSG_ ||
|| SENDER || CHAR(32) || H(MAC + IP + username_) SHA-1 base 64 || 
|| RECIVER || CHAR(32)|| H(MAC + IP + username_) SHA-1 base 64 - moze byc puste || 
|| MSG_ID|| LONG|| zegar logiczny||
|| MAC || MATRIX || macierz ||
|| VEC || VECTOR || wektor kolejnosci ||
|| CONTENT || STRING || Hello world!||

macierz:

kolumnami wiedza uzytkownikow
pojedyncza komorka: wiedza o wiedzy o zegarze logicznym uzytkownikow 

wektor kolejności:
|| id usera, ktory ma wiedze na i-tej kolumnie tabeli||